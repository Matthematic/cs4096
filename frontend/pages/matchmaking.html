<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Kilobytes Of Tetris</title>

	<!-- Bootstrap Core CSS -->
	<link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

	<!-- MetisMenu CSS -->
	<link href="../bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="../css/sb-admin-2.css" rel="stylesheet">

	<!-- Custom Fonts -->
	<link href="../bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

	<!-- jQuery -->
	<script src="../bower_components/jquery/dist/jquery.min.js"></script>

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->

	<script>
		$(function(){
			$("#navbars").load("navbars.html");
		});
	</script>

	<script>
		$(document).ready(function() {
			$.ajax({
				url: "/api/load_open_games__ranked",
				method: "post",
				success: function(data){
					console.log("data received");
					console.log(data);

					for( var i=0; i < data.length; i++ )
					{
						$('#ranked_tbody').append('<tr>' +
											'<td>' + data[i].username + '</td>' +
											'<td>' + data[i].elo + '</td>' +
											'<td>' + data[i].gametype + '</td>' +
											'</tr>'
						);
					}

				},
				callback: function(){
					console.log("data received");
				},
				failure: function(){
					console.log("error getting open game data");
				},
			});

			$.ajax({
				url: "/api/load_open_games__social",
				method: "post",
				success: function(data){
					console.log("data received");
					console.log(data);

					for( var i=0; i < data.length; i++ )
					{
						$('#social_tbody').append('<tr>' +
											'<td>' + data[i].username + '</td>' +
											'<td>' + data[i].elo + '</td>' +
											'<td>' + data[i].gametype + '</td>' +
											'</tr>'
						);
					}

				},
				callback: function(){
					console.log("data received");
				},
				failure: function(){
					console.log("error getting open game data");
				},
			});

			$('#ranked_tbody').click(function() {
				alert("You clicked an open game. This means you have accepted that game and the game should automatically start");
			});

			$('#social_tbody').click(function() {
				alert("You clicked an open game. This means you have accepted that game and the game should automatically start");
			});
		});


		var send_play_request = function() {
			var inviteForm = $("#inviteForm");
			var data = inviteForm.serializeArray();
			console.log(data);
			var new_data = {};

			var i;
			for (i = 0; i < data.length; i++) {
				new_data[data[i]["name"]] = data[i]["value"];
			}
			console.log(new_data);

			$.ajax({
				url: "/api/invite-user",
				datatype: "json",
				data: new_data,
				method: "post",
				success: function(){
					alert("invite sent");
					console.log("invite sent");
				},
				callback: function(){
					alert("invite sent");
					console.log("invite sent");
				},
				failure: function(){
					alert("invite not sent");
					console.log("invite not sent");
				},
			});

			// for some reason putting these inside the ajax's success function wouldn't work
			$('#username').val('');
			$('#email').val('');

		}
	</script>

	<style>
		#ranked {
			cursor: pointer;
		}
		#social {
			cursor: pointer;
		}
		.nav-tabs > li > a:hover{
			background-color: #303136 !important;
			border: medium none;
			border-radius: 0;
			color:#fff;
		}
	</style>
</head>

<body>
	<div id="wrapper">
		<div id="navbars"></div>
		<!-- Page Content -->
		<div id="page-wrapper">
			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-12">
						<h1 class="page-header">Matchmaking</h1>
						<!--
						<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#create_game_label">Create a game</button onclick="console.log('clicked');">
						<div id="create_game_label" class="collapse">
							Game Created Successfully
						</div>
						-->
						<div id="Tabs" role="tabpanel">
							<!-- Nav tabs -->
							<ul class="nav nav-tabs nav-justified" role="tablist">
								<li class="active">
									<a href="#ranked" role="tab" data-toggle="tab"><h4>Ranked</h4></a>
								</li>
								<li>
									<a href="#social" role="tab" data-toggle="tab"><h4>Social</h4></a>
								</li>
								<li>
									<a href="#invite" role="tab" data-toggle="tab"><h4>Invite</h4></a>
								</li>
								<li>
									<a href="#watch" role="tab" data-toggle="tab"><h4>Watch</h4></a>
								</li>
							</ul>
							<!-- Tab panes -->
							<div class="tab-content" style="padding-top: 20px">
								<div role="tabpanel" class="tab-pane fade in active" id="ranked">
									<h3>Open Games - these games affect your rating</h3>
									<table class="table table-hover" id="ranked">
										<thead>
										<tr>
											<th>Username</th>
											<th>Elo Rating</th>
											<th>Gametype</th>
										</tr>
										</thead>
										<tbody id="ranked_tbody">
										</tbody>
									</table>
								</div>
								<div role="tabpanel" class="tab-pane fade" id="social">
									<h3>Open Games - these games do NOT affect your rating</h3>
									<table class="table table-hover" id="social">
										<thead>
										<tr>
											<th>Username</th>
											<th>Elo Rating</th>
											<th>Gametype</th>
										</tr>
										</thead>
										<tbody id="social_tbody">
										</tbody>
									</table>
								</div>
								<div role="tabpanel" class="tab-pane fade" id="invite">
									<h3>Enter either a username or an email address.</h3>
									<h4>We will send a private game request to that user.</h4>
									<form method="POST" class="form-horizontal" id="inviteForm">
										<div class="control-group">
											<label class="control-label" for="username">Username</label>
											<div class="controls">
												<input type="text" name="username" id="username" placeholder="Friend's username">
											</div>
										</div>
										<div class="control-group">
											<label class="control-label" for="email">Email Address</label>
											<div class="controls">
												<input type="text" name="email" id="email" placeholder="Friend's email address">
											</div>
										</div>
										</br>
										<input type="button" value="Submit" class="btn btn-success column-centered" onclick="send_play_request();">
									</form>
								</div>
								<div role="tabpanel" class="tab-pane fade" id="watch">
									<h3>This is the Watch a Game page.</h3>
									<h4>There will be a list of current games being played, and you will be able to spectate.</h4>
								</div>
							</div>
						</div>
					</div>
					<!-- /.col-lg-12 -->
				</div>
				<!-- /.row -->
			</div>
			<!-- /.container-fluid -->
		</div>
		<!-- /#page-wrapper -->

	</div>
	<!-- /#wrapper -->

	<!-- jQuery -->
	<script src="../bower_components/jquery/dist/jquery.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- Metis Menu Plugin JavaScript -->
	<script src="../bower_components/metisMenu/dist/metisMenu.min.js"></script>

</body>

</html>
